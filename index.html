<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="MTG Probability Calculator for Portent of Calamity, Primal Surge, and Genesis Wave">
    <meta name="theme-color" content="#0a0a12">
    <title>MTG Probability Calculator</title>

    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

    <!-- Fonts - preload for performance -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/ux-enhancements.css">
</head>
<body class="theme-portent">
    <div class="container">
        <!-- SHARED DECK CONFIGURATION -->
        <section class="panel collapsible-panel expanded" id="deck-config" aria-label="Deck configuration">
            <div class="panel-header">
                <h2>üìö Deck Configuration</h2>
                <button class="collapse-btn" aria-label="Toggle section">
                    <span class="collapse-icon">‚ñº</span>
                </button>
            </div>

            <div class="panel-content">
                <div class="input-group">
                    <label style="margin-bottom: 8px;">Cards by type in library</label>
                    <div class="type-grid">
                        <div class="type-input">
                            <label for="deck-creatures">Creature</label>
                            <input type="number" id="deck-creatures" value="25" min="0" aria-label="Creatures">
                        </div>
                        <div class="type-input">
                            <label for="deck-instants">Instant</label>
                            <input type="number" id="deck-instants" value="8" min="0" aria-label="Instants">
                        </div>
                        <div class="type-input">
                            <label for="deck-sorceries">Sorcery</label>
                            <input type="number" id="deck-sorceries" value="6" min="0" aria-label="Sorceries">
                        </div>
                        <div class="type-input">
                            <label for="deck-artifacts">Artifact</label>
                            <input type="number" id="deck-artifacts" value="4" min="0" aria-label="Artifacts">
                        </div>
                        <div class="type-input">
                            <label for="deck-enchantments">Enchant</label>
                            <input type="number" id="deck-enchantments" value="3" min="0" aria-label="Enchantments">
                        </div>
                        <div class="type-input">
                            <label for="deck-planeswalkers">Planeswalker</label>
                            <input type="number" id="deck-planeswalkers" value="2" min="0" aria-label="Planeswalkers">
                        </div>
                        <div class="type-input">
                            <label for="deck-lands">Land</label>
                            <input type="number" id="deck-lands" value="32" min="0" aria-label="Lands">
                        </div>
                        <div class="type-input">
                            <label for="deck-battles">Battle</label>
                            <input type="number" id="deck-battles" value="0" min="0" aria-label="Battles">
                        </div>
                    </div>
                    <div class="deck-total">
                        Total cards in library: <span id="deck-total">80</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab Navigation -->
        <nav class="tab-nav" role="navigation" aria-label="Calculator selection">
            <button class="tab-button portent active" data-tab="portent" aria-pressed="true">
                ‚ö° Portent of Calamity
            </button>
            <button class="tab-button surge" data-tab="surge" aria-pressed="false">
                üåø Primal Surge
            </button>
            <button class="tab-button wave" data-tab="wave" aria-pressed="false">
                üåä Genesis Wave
            </button>
        </nav>

        <!-- PORTENT TAB -->
        <div id="portent-tab" class="tab-content active" role="tabpanel" aria-labelledby="portent">
            <h1>‚ö° Portent of Calamity Calculator</h1>
            <p class="card-text">"A 9 mana draw 3, nice!"</p>

            <div class="main-grid single-column">
                <section class="panel" aria-label="Configuration">
                    <h2>‚öôÔ∏è Calculation Settings</h2>
                    <div class="input-group">
                        <label for="portent-xValue">X value (cards to reveal)</label>
                        <div class="x-slider-row">
                            <input type="range" id="portent-xSlider" value="5" min="1" max="20" step="1" aria-label="X value slider">
                            <input type="number" id="portent-xValue" value="5" min="1" max="50" class="x-number" aria-label="X value number input">
                        </div>
                    </div>
                </section>

                <section class="panel" aria-label="Probability chart">
                    <h2>üìà Probability & Expected Cards vs X Value</h2>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="portent-combinedChart" role="img" aria-label="Portent probability chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #c084fc;"></span> P(Free Spell) %</span>
                        <span class="legend-item"><span class="legend-color" style="background: #dc2626;"></span> Expected Cards to Hand</span>
                    </div>
                </section>

                <section class="panel" aria-label="X value comparison">
                    <h2>üîç X Value Comparison</h2>
                    <div class="table-wrapper">
                        <table class="comparison-table" id="portent-comparisonTable">
                        </table>
                    </div>
                </section>
            </div>
        </div>

        <!-- PRIMAL SURGE TAB -->
        <div id="surge-tab" class="tab-content" role="tabpanel" aria-labelledby="surge">
            <h1>üåø Primal Surge Calculator</h1>
            <p class="card-text">"So do you win here or...?"</p>

            <div class="main-grid single-column">
                <section class="panel" aria-label="Expected permanents chart">
                    <h2>üìà Expected Permanents & Deck Percentage</h2>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="surge-chart" role="img" aria-label="Primal Surge chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #4ade80;"></span> Expected Permanents</span>
                        <span class="legend-item"><span class="legend-color" style="background: #dc2626;"></span> % of Deck Played</span>
                    </div>
                </section>

                <section class="panel" aria-label="Simulation results">
                    <h2>üîç Simulation Results</h2>
                    <div class="table-wrapper">
                        <table class="comparison-table" id="surge-statsTable">
                        </table>
                    </div>
                </section>
            </div>
        </div>

        <!-- GENESIS WAVE TAB -->
        <div id="wave-tab" class="tab-content" role="tabpanel" aria-labelledby="wave">
            <h1>üåä Genesis Wave Calculator</h1>
            <p class="card-text">"You may put any number of permanent cards with mana value X or less from among them onto the battlefield"</p>

            <div class="main-grid single-column">
                <section class="panel" aria-label="Configuration">
                    <h2>‚öôÔ∏è Calculation Settings</h2>
                    <div class="input-group">
                        <label for="wave-xValue">X value (cards to reveal)</label>
                        <div class="x-slider-row">
                            <input type="range" id="wave-xSlider" value="10" min="1" max="30" step="1">
                            <input type="number" id="wave-xValue" value="10" min="1" max="50" class="x-number">
                        </div>
                    </div>
                </section>

                <section class="panel" aria-label="Expected permanents chart">
                    <h2>üìà Expected Permanents vs X Value</h2>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="wave-chart" role="img" aria-label="Genesis Wave chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #38bdf8;"></span> Expected Permanents Played</span>
                        <span class="legend-item"><span class="legend-color" style="background: #22c55e;"></span> Total Cards Revealed</span>
                    </div>
                </section>

                <section class="panel" aria-label="X value comparison">
                    <h2>üîç X Value Comparison</h2>
                    <div class="table-wrapper">
                        <table class="comparison-table" id="wave-comparisonTable">
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Load Chart.js on demand -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Main application - use modules -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
