<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="MTG Probability Calculator for Portent of Calamity, Primal Surge, and Genesis Wave">
    <meta name="theme-color" content="#0a0a12">
    <title>MTG Probability Calculator</title>

    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

    <!-- Fonts - preload for performance -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/rashmi-theme.css">
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/ux-enhancements.css">
</head>
<body class="theme-portent">
    <div class="container">
        <!-- SHARED DECK CONFIGURATION -->
        <section class="panel collapsible-panel expanded" id="deck-config" aria-label="Deck configuration">
            <div class="panel-header">
                <h2>üìö Deck Configuration</h2>
                <button class="collapse-btn" aria-label="Toggle section">
                    <span class="collapse-icon">‚ñº</span>
                </button>
            </div>

            <div class="panel-content">
                <div class="input-group import-section">
                    <label for="moxfield-input">Import from Moxfield or Archidekt (URL or ID)</label>
                    <div class="import-url-row" style="display: flex; gap: 8px; margin-bottom: 12px;">
                        <input type="text" id="moxfield-input" placeholder="https://moxfield.com/decks/..." style="flex: 1; padding: 10px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-color);">
                        <button id="moxfield-import-btn" class="import-btn" aria-label="Import from Archidekt or  Moxfield">
                            ‚òÅÔ∏è Import
                        </button>
                    </div>
                    <div style="text-align: center; margin-bottom: 12px; color: var(--text-dim); font-size: 0.9em; position: relative;">
                        <span style="background: var(--panel-bg); padding: 0 10px; position: relative; z-index: 1;">OR PASTE TEXT</span>
                        <div style="position: absolute; top: 50%; left: 0; right: 0; border-top: 1px solid var(--border-color); z-index: 0;"></div>
                    </div>

                    <label for="decklist-input">Import Decklist (paste text)</label>
                    <textarea
                        id="decklist-input"
                        placeholder="Paste your decklist here...&#10;Format: 4 Lightning Bolt&#10;1 Jace, the Mind Sculptor&#10;etc.. Or export>plain text from your deck builder."
                        rows="4"
                        aria-label="Decklist input"></textarea>
                    <button id="import-btn" class="import-btn" aria-label="Import decklist">
                        üîç Import & Analyze
                    </button>
                    <div class="import-progress" id="import-progress">
                        <div class="import-progress-bar" id="import-progress-bar"></div>
                    </div>
                    <div id="import-status" class="import-status" role="status" aria-live="polite"></div>
                </div>

                <div class="input-group">
                    <label style="margin-bottom: 8px;">Cards by type in library</label>
                    <div class="type-grid">
                        <div class="type-input">
                            <label for="deck-creatures">Creature</label>
                            <input type="number" id="deck-creatures" value="25" min="0" aria-label="Creatures">
                        </div>
                        <div class="type-input">
                            <label for="deck-instants">Instant</label>
                            <input type="number" id="deck-instants" value="8" min="0" aria-label="Instants">
                        </div>
                        <div class="type-input">
                            <label for="deck-sorceries">Sorcery</label>
                            <input type="number" id="deck-sorceries" value="6" min="0" aria-label="Sorceries">
                        </div>
                        <div class="type-input">
                            <label for="deck-artifacts">Artifact</label>
                            <input type="number" id="deck-artifacts" value="4" min="0" aria-label="Artifacts">
                        </div>
                        <div class="type-input">
                            <label for="deck-enchantments">Enchant</label>
                            <input type="number" id="deck-enchantments" value="3" min="0" aria-label="Enchantments">
                        </div>
                        <div class="type-input">
                            <label for="deck-planeswalkers">Planeswalker</label>
                            <input type="number" id="deck-planeswalkers" value="2" min="0" aria-label="Planeswalkers">
                        </div>
                        <div class="type-input">
                            <label for="deck-lands">Land</label>
                            <input type="number" id="deck-lands" value="32" min="0" aria-label="Lands">
                        </div>
                        <div class="type-input">
                            <label for="deck-battles">Battle</label>
                            <input type="number" id="deck-battles" value="0" min="0" aria-label="Battles">
                        </div>
                    </div>
                    <div class="deck-total">
                        Total cards in library: <span id="deck-total">80</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Calculator Selector Dropdown (Mobile) -->
        <div class="calculator-selector" id="calculator-selector" role="navigation" aria-label="Calculator selection">
            <button class="selector-button" id="selector-button" aria-haspopup="true" aria-expanded="false">
                <div class="selector-current">
                    <span class="selector-icon">‚ö°</span>
                    <span class="selector-name">Portent of Calamity</span>
                </div>
                <span class="selector-arrow">‚ñº</span>
            </button>
            <div class="selector-dropdown" id="selector-dropdown" role="menu">
                <div class="selector-option active" data-tab="portent" role="menuitem">
                    <span class="selector-option-icon">‚ö°</span>
                    <span>Portent of Calamity</span>
                </div>
                <div class="selector-option" data-tab="surge" role="menuitem">
                    <span class="selector-option-icon">üåø</span>
                    <span>Primal Surge</span>
                </div>
                <div class="selector-option" data-tab="wave" role="menuitem">
                    <span class="selector-option-icon">üåä</span>
                    <span>Genesis Wave</span>
                </div>
                <div class="selector-option" data-tab="vortex" role="menuitem">
                    <span class="selector-option-icon">üåÄ</span>
                    <span>Monstrous Vortex</span>
                </div>
                <div class="selector-option" data-tab="rashmi" role="menuitem">
                    <span class="selector-option-icon">üåå</span>
                    <span>Rashmi</span>
                </div>
                <div class="selector-option" data-tab="lands" role="menuitem">
                    <span class="selector-option-icon">üèîÔ∏è</span>
                    <span>Land Drops</span>
                </div>
            </div>
        </div>

        <!-- Tab Navigation (Desktop) -->
        <nav class="tab-nav" role="navigation" aria-label="Calculator selection">
            <button class="tab-button portent active" data-tab="portent" aria-pressed="true">
                ‚ö° Portent of Calamity
            </button>
            <button class="tab-button surge" data-tab="surge" aria-pressed="false">
                üåø Primal Surge
            </button>
            <button class="tab-button wave" data-tab="wave" aria-pressed="false">
                üåä Genesis Wave
            </button>
            <button class="tab-button vortex" data-tab="vortex" aria-pressed="false">
                üåÄ Monstrous Vortex
            </button>
            <button class="tab-button lands" data-tab="lands" aria-pressed="false">
                üèîÔ∏è Land Drops
            </button>
            <button class="tab-button rashmi" data-tab="rashmi" aria-pressed="false">
                üåå Rashmi
            </button>
        </nav>

        <!-- PORTENT TAB -->
        <div id="portent-tab" class="tab-content active" role="tabpanel" aria-labelledby="portent">
            <h1>‚ö° Portent of Calamity Calculator</h1>
            <p class="card-text">"A 9 mana draw 3, nice!"</p>

            <div class="main-grid single-column">
                <section class="panel" aria-label="Configuration">
                    <h2>‚öôÔ∏è Calculation Settings</h2>
                    <div class="input-group">
                        <label for="portent-xValue">X value (cards to reveal)</label>
                        <div class="x-slider-row">
                            <input type="range" id="portent-xSlider" value="5" min="1" max="20" step="1" aria-label="X value slider">
                            <input type="number" id="portent-xValue" value="5" min="1" max="50" class="x-number" aria-label="X value number input">
                        </div>
                    </div>
                </section>

                <section class="panel" aria-label="Probability chart">
                    <h2>üìà Probability & Expected Cards vs X Value</h2>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="portent-combinedChart" role="img" aria-label="Portent probability chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #c084fc;"></span> P(Free Spell) %</span>
                        <span class="legend-item"><span class="legend-color" style="background: #dc2626;"></span> Expected Cards to Hand</span>
                    </div>
                </section>

                <section class="panel" id="portent-stats" aria-label="Current X analysis">
                    <!-- Analysis content will be inserted here -->
                </section>

                <section class="panel" id="portent-sample-reveals" aria-label="Sample reveals">
                    <h2>üé¥ Sample Portent Reveals</h2>
                    <div style="display: flex; gap: var(--spacing-md); align-items: center; margin-bottom: var(--spacing-md); flex-wrap: wrap;">
                        <label for="portent-sample-count" style="color: var(--text-secondary);">Simulations:</label>
                        <input type="number" id="portent-sample-count" min="1" max="10000" value="10"
                               style="width: 100px; padding: 8px; background: var(--panel-bg-alt); border: 1px solid var(--accent); border-radius: var(--radius-md); color: var(--text-light); text-align: center;">
                        <button id="portent-draw-reveals-btn" class="import-btn">Run Simulations</button>
                        <span style="color: var(--text-dim); font-size: 0.85em;">(1-10000)</span>
                    </div>
                    <div id="portent-reveals-display">
                        <!-- Sample reveals will be displayed here -->
                    </div>
                </section>

                <section class="panel" aria-label="X value comparison">
                    <h2>üîç X Value Comparison</h2>
                    <div class="table-wrapper">
                        <table class="comparison-table" id="portent-comparisonTable">
                        </table>
                    </div>
                </section>
            </div>
        </div>

        <!-- PRIMAL SURGE TAB -->
        <div id="surge-tab" class="tab-content" role="tabpanel" aria-labelledby="surge">
            <h1>üåø Primal Surge Calculator</h1>
            <p class="card-text">"So do you win here or...?"</p>

            <div class="main-grid single-column">
                <section class="panel" aria-label="Expected permanents chart">
                    <h2>üìà Expected Permanents & Deck Percentage</h2>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="surge-chart" role="img" aria-label="Primal Surge chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #4ade80;"></span> Expected Permanents</span>
                        <span class="legend-item"><span class="legend-color" style="background: #dc2626;"></span> % of Deck Played</span>
                    </div>
                </section>

                <section class="panel" aria-label="Simulation results">
                    <h2>üîç Simulation Results</h2>
                    <div class="table-wrapper">
                        <table class="comparison-table" id="surge-statsTable">
                        </table>
                    </div>
                </section>

                <section class="panel" id="surge-sample-reveals" aria-label="Sample reveals">
                    <h2>üé¥ Sample Primal Surge Reveals</h2>
                    <div style="display: flex; gap: var(--spacing-md); align-items: center; margin-bottom: var(--spacing-md); flex-wrap: wrap;">
                        <label for="surge-sample-count" style="color: var(--text-secondary);">Simulations:</label>
                        <input type="number" id="surge-sample-count" min="1" max="10000" value="10"
                               style="width: 100px; padding: 8px; background: var(--panel-bg-alt); border: 1px solid var(--accent); border-radius: var(--radius-md); color: var(--text-light); text-align: center;">
                        <button id="surge-draw-reveals-btn" class="import-btn">Run Simulations</button>
                        <span style="color: var(--text-dim); font-size: 0.85em;">(1-10000)</span>
                    </div>
                    <div id="surge-reveals-display">
                        <!-- Sample reveals will be displayed here -->
                    </div>
                </section>
            </div>
        </div>

        <!-- GENESIS WAVE TAB -->
        <div id="wave-tab" class="tab-content" role="tabpanel" aria-labelledby="wave">
            <h1>üåä Genesis Wave Calculator</h1>
            <p class="card-text">"Best green mill spell in the game"</p>

            <div class="main-grid single-column">
                <section class="panel" aria-label="Configuration">
                    <h2>‚öôÔ∏è Calculation Settings</h2>
                    <div class="input-group">
                        <label for="wave-xValue">X value (cards to reveal)</label>
                        <div class="x-slider-row">
                            <input type="range" id="wave-xSlider" value="10" min="1" max="30" step="1" aria-label="X value slider">
                            <input type="number" id="wave-xValue" value="10" min="1" max="50" class="x-number" aria-label="X value number input">
                        </div>
                    </div>
                </section>

                <section class="panel" aria-label="Expected permanents chart">
                    <h2>üìà Expected Permanents vs X Value</h2>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="wave-chart" role="img" aria-label="Genesis Wave chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #38bdf8;"></span> Expected Permanents Played</span>
                        <span class="legend-item"><span class="legend-color" style="background: #22c55e;"></span> Total Cards Revealed</span>
                    </div>
                </section>

                <section class="panel" id="wave-stats" aria-label="Current X analysis">
                    <!-- Analysis content will be inserted here -->
                </section>

                <section class="panel" aria-label="X value comparison">
                    <h2>üîç X Value Comparison</h2>
                    <div class="table-wrapper">
                        <table class="comparison-table" id="wave-comparisonTable">
                        </table>
                    </div>
                </section>

                <section class="panel" id="wave-sample-reveals" aria-label="Sample reveals">
                    <h2>üé¥ Sample Genesis Wave Reveals</h2>
                    <div style="display: flex; gap: var(--spacing-md); align-items: center; margin-bottom: var(--spacing-md); flex-wrap: wrap;">
                        <label for="wave-sample-count" style="color: var(--text-secondary);">Simulations:</label>
                        <input type="number" id="wave-sample-count" min="1" max="10000" value="10"
                               style="width: 100px; padding: 8px; background: var(--panel-bg-alt); border: 1px solid var(--accent); border-radius: var(--radius-md); color: var(--text-light); text-align: center;">
                        <button id="wave-draw-reveals-btn" class="import-btn">Run Simulations</button>
                        <span style="color: var(--text-dim); font-size: 0.85em;">(1-10000)</span>
                    </div>
                    <div id="wave-reveals-display">
                        <!-- Sample reveals will be displayed here -->
                    </div>
                </section>
            </div>
        </div>

        <!-- VORTEX TAB -->
        <div id="vortex-tab" class="tab-content" role="tabpanel" aria-labelledby="vortex">
            <h1>üåÄ Monstrous Vortex Calculator</h1>
            <p class="card-text">"Big Creature, Big Value"</p>

            <div class="main-grid single-column">
                <section class="panel" id="vortex-import-warning" aria-label="Import required notice">
                    <h2>‚ö†Ô∏è Import Required</h2>
                    <p style="color: var(--text-secondary); margin: 0;">
                        This calculator requires decklist import to work. Please use the
                        <strong style="color: var(--text-light);">üìö Deck Configuration</strong> panel above to import your decklist.
                        The import will automatically detect creatures with power 5+ and CMC distribution.
                    </p>
                </section>

                <section class="panel" aria-label="Configuration">
                    <h2>‚öôÔ∏è Calculation Settings</h2>
                    <div class="input-group">
                        <label for="vortex-cmcValue">CMC of power 5+ creature being cast</label>
                        <div class="x-slider-row">
                            <input type="range" id="vortex-cmcSlider" value="6" min="3" max="10" step="1" aria-label="Creature CMC slider">
                            <input type="number" id="vortex-cmcValue" value="6" min="3" max="15" class="x-number" aria-label="Creature CMC number input">
                        </div>
                    </div>
                </section>


                <section class="panel" aria-label="Expected spells chart">
                    <h2>üìà Discover Value by Creature CMC</h2>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="vortex-chart" role="img" aria-label="Vortex discover chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #f97316;"></span> Avg Free Mana Value</span>
                        <span class="legend-item"><span class="legend-color" style="background: #22c55e;"></span> Avg Spell CMC Found</span>
                        <span class="legend-item"><span class="legend-color" style="background: #c084fc;"></span> Avg Spells Cast</span>
                    </div>
                </section>

                <section class="panel" aria-label="Discover analysis">
                    <div id="vortex-stats"></div>
                </section>

                <section class="panel" id="vortex-sample-reveals" aria-label="Sample reveals">
                    <h2>üé¥ Sample Discover Reveals</h2>
                    <div style="display: flex; gap: var(--spacing-md); align-items: center; margin-bottom: var(--spacing-md); flex-wrap: wrap;">
                        <label for="vortex-sample-count" style="color: var(--text-secondary);">Simulations:</label>
                        <input type="number" id="vortex-sample-count" min="1" max="10000" value="10"
                               style="width: 100px; padding: 8px; background: var(--panel-bg-alt); border: 1px solid var(--accent); border-radius: var(--radius-md); color: var(--text-light); text-align: center;">
                        <button id="vortex-draw-reveals-btn" class="import-btn">Run Simulations</button>
                        <span style="color: var(--text-dim); font-size: 0.85em;">(1-10000)</span>
                    </div>
                    <div id="vortex-reveals-display">
                        <!-- Sample reveals will be displayed here -->
                    </div>
                </section>

                <section class="panel" aria-label="Creature comparison">
                    <h2>üîç CMC Comparison</h2>
                    <div class="table-wrapper">
                        <table class="comparison-table" id="vortex-comparisonTable">
                        </table>
                    </div>
                </section>
            </div>
        </div>

        <!-- LAND DROPS TAB -->
        <div id="lands-tab" class="tab-content" role="tabpanel" aria-labelledby="lands">
            <h1>üèîÔ∏è Land Drop Calculator</h1>
            <p class="card-text">"Will I make my land drops?"</p>

            <div class="main-grid single-column">
                <section class="panel" aria-label="Opening hand distribution">
                    <h2>üìä Opening Hand Land Distribution</h2>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="lands-opening-chart" role="img" aria-label="Opening hand lands chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #4ade80;"></span> Probability of Drawing X Lands</span>
                    </div>
                </section>

                <section class="panel" aria-label="Land drop probability">
                    <h2>üìà Land Drop Probability by Turn</h2>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="lands-landdrop-chart" role="img" aria-label="Land drop probability chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #4ade80;"></span> Make Land Drop</span>
                        <span class="legend-item"><span class="legend-color" style="background: #dc2626;"></span> Miss Land Drop</span>
                    </div>
                </section>

                <section class="panel" aria-label="Statistics">
                    <h2>üîç Land Drop Statistics</h2>
                    <div class="table-wrapper">
                        <table class="comparison-table" id="lands-statsTable">
                        </table>
                    </div>
                </section>
            </div>
        </div>

        <!-- RASHMI TAB -->
        <div id="rashmi-tab" class="tab-content" role="tabpanel" aria-labelledby="rashmi">
            <h1>üåå Rashmi, Eternities Crafter Calculator</h1>
            <p class="card-text">"The simic phyrexian arena"</p>

            <div class="main-grid single-column">
                <section class="panel" id="rashmi-import-warning" aria-label="Import required notice">
                    <h2>‚ö†Ô∏è Import Required</h2>
                    <p style="color: var(--text-secondary); margin: 0;">
                        This calculator requires decklist import to work. Please use the
                        <strong style="color: var(--text-light);">üìö Deck Configuration</strong> panel above to import your decklist.
                        The import will automatically detect CMC distribution for your non-land spells.
                    </p>
                </section>

                <section class="panel" id="rashmi-stats" aria-label="Configuration">
                    <h2>‚öôÔ∏è Calculation Settings</h2>
                    <div class="input-group">
                        <label for="rashmi-cmcValue">CMC of spell you're casting</label>
                        <div class="x-slider-row">
                            <input type="range" id="rashmi-cmcSlider" value="3" min="1" max="10" step="1" aria-label="Cast CMC slider">
                            <input type="number" id="rashmi-cmcValue" value="3" min="1" max="15" class="x-number" aria-label="Cast CMC number input">
                        </div>
                    </div>
                    <div class="input-group" style="margin-top: var(--spacing-md);">
                        <label style="display: flex; align-items: center; gap: var(--spacing-sm); cursor: pointer; user-select: none;">
                            <input type="checkbox" id="rashmi-exclude-x" style="width: auto; cursor: pointer;">
                            <span>Exclude X spells from "free spell" calculation</span>
                        </label>
                        <small style="color: var(--text-dim); display: block; margin-top: 4px; margin-left: 24px;">
                            When revealed from library, X=0, so X spells can't be cast for free with Rashmi
                        </small>
                    </div>
                </section>
                
                <section class="panel" aria-label="Probability chart">
                    <h2>üìà Free Spell Probability vs Cast CMC</h2>
                    <div class="chart-container" style="height: 320px;">
                        <canvas id="rashmi-chart" role="img" aria-label="Rashmi probability chart"></canvas>
                    </div>
                    <div class="chart-legend">
                        <span class="legend-item"><span class="legend-color" style="background: #22c55e;"></span> P(Free Spell) %</span>
                        <span class="legend-item"><span class="legend-color" style="background: #3b82f6;"></span> Expected Free CMC</span>
                    </div>
                </section>

                <section class="panel" id="rashmi-breakdown" aria-label="CMC distribution">
                </section>

                <section class="panel" id="rashmi-sample-reveals" aria-label="Sample reveals">
                    <h2>üé¥ Sample Cast Triggers</h2>
                    <div style="display: flex; gap: var(--spacing-md); align-items: center; margin-bottom: var(--spacing-md); flex-wrap: wrap;">
                        <label for="rashmi-sample-count" style="color: var(--text-secondary);">Simulations:</label>
                        <input type="number" id="rashmi-sample-count" min="1" max="10000" value="10"
                               style="width: 100px; padding: 8px; background: var(--panel-bg-alt); border: 1px solid var(--accent); border-radius: var(--radius-md); color: var(--text-light); text-align: center;">
                        <button id="rashmi-draw-reveals-btn" class="import-btn">Run Simulations</button>
                        <span style="color: var(--text-dim); font-size: 0.85em;">(1-10000)</span>
                    </div>
                    <div id="rashmi-reveals-display">
                        <!-- Sample reveals will be displayed here -->
                    </div>
                </section>


                <section class="panel" aria-label="CMC comparison">
                    <h2>üîç Cast CMC Comparison</h2>
                    <div class="table-wrapper">
                        <table class="comparison-table" id="rashmi-comparisonTable">
                        </table>
                    </div>
                </section>
            </div>
        </div>

    </div>

    <!-- Load Chart.js on demand -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Main application - use modules -->
    <script type="module" src="js/main.js"></script>
</body>
</html>
